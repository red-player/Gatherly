# Nodejs

# Environment vars
This project uses the following environment variables:

| Name                          | Description                         | Default Value                                  |
| ----------------------------- | ------------------------------------| -----------------------------------------------|
|CORS           | Cors accepted values            | "*" ¬†    |


# Pre-requisites
- Install [Node.js](https://nodejs.org/en/) version new ones


# Getting started

- navigate to folder where you want to initialize the project 
- Clone the repository
```
git clone https://github.com/<username>/<projectName>.git
```
- Install dependencies
```
cd <project_name>
npm install
```
- Prisma Generate (only if project is using prisma ORM)
```
npx prisma generate
```
- Build and run the project
```
npm run
```

  then it probably executed like this `http://localhost:${YOUR_PORT}` 



# TypeScript + Node 
The main purpose of this repository is to show a project setup and workflow for writing microservice.

## Getting TypeScript
Add Typescript to project `npm`.
```
npm install -D typescript
```

## Project Structure
The folder structure of this app is explained below:

| Name | Description |
| ------------------------ | --------------------------------------------------------------------------------------------- |
| **dist**                 | Contains the distributable (or output) from your TypeScript build.  |
| **node_modules**         | Contains all  npm dependencies                                                            |
| **src**                  | Contains  source code that will be compiled to the dist dir                               |
| **src/config**              | Contains environment-specific variables and settings that are used throughout the application.|  
| **src/controllers**      | Controllers define functions to serve various express routes. 
| **src/middlewares**      | Express middlewares which process the incoming requests before handling them down to the routes
| **src/routes**           | Contain all express routes, separated by module/area of application                       
| **src/service**           |  Bussiness logic|
| **src/testAPI**      | Perform Test API function |
| **src/utils**      | collection of reusable utility modules that streamline common tasks and promote code organization and reusability|
| **src**/index.ts         | Entry point to express app                                                               |
|.editorconfig| simple configuration file that helps maintain consistent coding styles across different editors and IDEs. It contains a set of rules and settings that define how code should be formatted and displayed.|
|.env| contain sensitive information or configuration settings that should not be hardcoded into the source code. |
|.gitignore| used to exclude files and directories that are generated during the development process, contain sensitive information, or are specific to individual developers' environments. |
|package-lock.json|  automatically generated by npm when you run `npm install`|
| package.json             | Contains npm dependencies as well as [build scripts](#what-if-a-library-isnt-on-definitelytyped)   
| tsconfig.json            | Config settings for compiling source code only written in TypeScript    |

## Building the project
### Configuring TypeScript compilation
```json
{
    "compilerOptions": {
      "target": "es2016",
      "module": "commonjs",
      "outDir": "./dist",
      "esModuleInterop": true,   
      "sourceMap": true,
      "forceConsistentCasingInFileNames": true,   
      "strict": true,    
      "skipLibCheck": true, 
      "allowSyntheticDefaultImports": true,
    },
    
    "include": [
      "src/**/*.ts"
      

    ],
    "exclude": [
      "test",
      "node_modules",
    
    ]
  }

```

### Running the build
All the different build steps are orchestrated via [npm scripts](https://docs.npmjs.com/misc/scripts).
Npm scripts basically allow us to call (and chain) terminal commands via npm.


| Npm Script        | Description                                                                                           |
| ----------------- | ----------------------------------------------------------------------------------------------------- |
| `dev`             | Runs `ts-node-dev` with `--respawn` and `--transpile-only` flags on `src/index.ts`.                   |
| `db:generate`     | Generates Prisma client code. Can be invoked with `npm run db:generate`.                               |
| `db:migrate-dev`  | Runs Prisma migrations in development environment. Can be invoked with `npm run db:migrate-dev`.       |
| `prisma-studio`   | Opens Prisma Studio, an interactive GUI for database management. Can be invoked with `npm run prisma-studio`. |
| `dev2`            | Concurrently runs TypeScript compiler in watch mode and nodemon to watch for changes in `dist/index.js`. Can be invoked with `npm run dev2`.          |


# Common Issues 

read the errors, understand the errors, and learn from the errors üëç

## Node.js

1. **Callback Hell**: Nested callback functions can lead to unreadable and difficult-to-maintain code.

**Solution**: Use Promises, async/await, to handle asynchronous operations cleanly and efficiently.

## Express

1. **CORS Errors**: Cross-Origin Resource Sharing (CORS) errors occur when a client-side script tries to make a request to a server that is in a different domain.

**Solution**: Enable CORS in Express using the `cors` middleware:
```javascript
const cors = require('cors');
app.use(cors());
```
2. **Body Parsing**: Express does not parse the request body by default.

**Solution**: Use body-parser middleware to parse request bodies:
```javascript
import { json } from "body-parser";
app.use(json());
```

## Prisma
if using Prisma ORM
1. **Migration Errors**: Prisma migration commands may fail due to conflicts or inconsistencies in the schema.

    **Solution**: Resolve migration conflicts manually by adjusting the schema or rolling back to a previous migration state.

2. **Database Connection Errors**: Prisma may fail to connect to the database due to misconfigured connection URLs or authentication issues.

    **Solution**: Double-check the database connection URL and credentials in the .env file. Ensure that the database server is running and accessible.

## MySQL
if using MySql connections
1. **Connection Timeout Errors**: MySQL connections may timeout, especially in applications with long-running queries or high load.

    **Solution**: Increase the connection timeout in the MySQL server configuration or adjust the connection pool settings in the Node.js application.

2. **SQL Injection Vulnerabilities**: Improperly sanitized user input can lead to SQL injection attacks.

    **Solution**: Use parameterized queries or ORM libraries like Sequelize or Prisma to prevent SQL injection attacks.


-----------------------------------------------------------------------------

Cooked by **ABDUL** 